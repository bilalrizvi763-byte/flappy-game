<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Bird Mobile Version</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #70c5ce;
    overscroll-behavior: none;
    touch-action: manipulation;
  }
  * { box-sizing: border-box; }
  canvas {
    display: block;
    margin: auto;
    background: #4ec0ca;
    border: none !important;
    image-rendering: auto;
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
// ---------------- CONFIG ----------------
const LOGICAL_WIDTH = 400;
const LOGICAL_HEIGHT = 600;

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let bird, pipes, score, gameOver, gameStarted, startStep;
let crashParticles = [];
let startButton = { width: 140, height: 45, x: 0, y: 0 };
let continueButton = { width: 160, height: 45, x: 0, y: 0 };
let yesButton = { width: 100, height: 40, x: 0, y: 0 };
let cloud = { x: 0, y: 50, width: 150, height: 80, speed: 1.5 };
let pipeTimer = null;

// ---------------- ASSETS ----------------
const assets = {
  bird: 'good.png',
  bananaTop: 'banana.upper.png',
  bananaBottom: 'banana.lower.png',
  cloud: 'cloud.png',
  start: 'mypic.jpg',
  crash: 'sound.mp3'
};

let images = {};
let sounds = {};

function loadImage(src) {
  return new Promise(res => {
    const img = new Image();
    img.onload = () => res(img);
    img.onerror = () => res(null);
    img.src = src;
  });
}

function loadAudio(src) {
  return new Promise(res => {
    try { const a = new Audio(src); a.preload='auto'; res(a); } 
    catch(e){ res(null); }
  });
}

async function loadAllAssets() {
  images.bird = await loadImage(assets.bird);
  images.bananaTop = await loadImage(assets.bananaTop);
  images.bananaBottom = await loadImage(assets.bananaBottom);
  images.cloud = await loadImage(assets.cloud);
  images.start = await loadImage(assets.start);
  sounds.crash = await loadAudio(assets.crash);
}

// ---------------- CANVAS FIX ----------------
function fixCanvas() {
  const ratio = window.devicePixelRatio || 1;
  const w = window.innerWidth;
  const h = window.innerHeight;
  const scale = Math.min(w / LOGICAL_WIDTH, h / LOGICAL_HEIGHT);

  canvas.style.width = LOGICAL_WIDTH * scale + "px";
  canvas.style.height = LOGICAL_HEIGHT * scale + "px";
  canvas.width = Math.round(LOGICAL_WIDTH * scale * ratio);
  canvas.height = Math.round(LOGICAL_HEIGHT * scale * ratio);

  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(scale * ratio, scale * ratio);
}

window.addEventListener('resize', fixCanvas);
window.addEventListener('orientationchange', () => setTimeout(fixCanvas, 200));
fixCanvas();

// ---------------- GAME STATE ----------------
function initState() {
  bird = { x:50, y:150, width:120, height:120, gravity:0.5, velocity:0 };
  pipes = [];
  score = 0;
  gameOver = false;
  gameStarted = false;
  startStep = 1;
  crashParticles = [];
}

function getLogicalPointer(mx,my){
  const rect = canvas.getBoundingClientRect();
  const scaleX = LOGICAL_WIDTH/rect.width;
  const scaleY = LOGICAL_HEIGHT/rect.height;
  return { x:(mx-rect.left)*scaleX, y:(my-rect.top)*scaleY };
}

// ---------------- BUTTON HANDLER ----------------
function handlePointer(mx,my){
  const p = getLogicalPointer(mx,my);
  const x = p.x, y = p.y;

  if(!gameStarted){
    if(startStep===1 && x>=startButton.x && x<=startButton.x+startButton.width &&
       y>=startButton.y && y<=startButton.y+startButton.height){
      startStep=2;
    } else if(startStep===2 && x>=continueButton.x && x<=continueButton.x+continueButton.width &&
              y>=continueButton.y && y<=continueButton.y+continueButton.height){
      gameStarted=true; startPipes();
    }
    return;
  }

  if(gameOver){
    if(x>=yesButton.x && x<=yesButton.x+yesButton.width &&
       y>=yesButton.y && y<=yesButton.y+yesButton.height){
      resetGame();
    }
  } else flapBird();
}

// ---------------- POINTER EVENTS ----------------
canvas.addEventListener('pointerdown', e=>{
  e.preventDefault && e.preventDefault();
  handlePointer(e.clientX, e.clientY);
},{passive:false});

// ---------------- GAME ACTIONS ----------------
function flapBird(){ if(!gameOver && gameStarted) bird.velocity=-7; }

function createPipe(){
  if(!gameStarted || gameOver) return;
  const gap = 220;
  const top = Math.random()*250+50;
  pipes.push({x:LOGICAL_WIDTH, top:top, bottom:top+gap, width:60, passed:false});
}

function startPipes(){ if(pipeTimer) clearInterval(pipeTimer); pipeTimer=setInterval(createPipe,1800); }
function stopPipes(){ if(pipeTimer){ clearInterval(pipeTimer); pipeTimer=null; } }

function resetGame(){ stopPipes(); initState(); gameStarted=true; startPipes(); }

// ---------------- CRASH PARTICLES ----------------
function createCrashParticles(x,y){
  for(let i=0;i<20;i++){
    crashParticles.push({x,y,vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, size:Math.random()*8+4, alpha:1});
  }
}

function drawCrashParticles(){
  for(let i=crashParticles.length-1;i>=0;i--){
    const p = crashParticles[i];
    ctx.fillStyle=`rgba(255,0,0,${p.alpha})`;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    p.x+=p.vx; p.y+=p.vy; p.alpha-=0.03;
    if(p.alpha<=0) crashParticles.splice(i,1);
  }
}

// ---------------- POPUPS ----------------
function drawStartPopup(){
  ctx.fillStyle="rgba(0,0,0,0.3)"; ctx.fillRect(0,0,LOGICAL_WIDTH,LOGICAL_HEIGHT);
  ctx.fillStyle="white"; ctx.fillRect(35,100,330,350); ctx.strokeRect(35,100,330,350);
  ctx.textAlign="center"; ctx.fillStyle="black";

  if(startStep===1){
    if(images.start){
      const w=290,h=180; let rw=w,rh=h; const ratio=images.start.width/images.start.height;
      if(w/h>ratio) rw=h*ratio; else rh=w/ratio;
      const dx=55+(w-rw)/2; const dy=120+(h-rh)/2;
      ctx.drawImage(images.start,dx,dy,rw,rh);
    }
    ctx.font="22px Arial"; ctx.fillText("To kaise hain aap log?",200,330);
    startButton.x=200-70; startButton.y=360; ctx.fillStyle="green";
    ctx.fillRect(startButton.x,startButton.y,startButton.width,startButton.height);
    ctx.fillStyle="white"; ctx.fillText("START",200,startButton.y+30);
  } else {
    ctx.font="20px Arial"; ctx.fillText("To chaliye shuru karte hain",200,260);
    ctx.fillText("bina kisi bakchodi ke ðŸ˜Ž",200,290);
    continueButton.x=200-80; continueButton.y=320; ctx.fillStyle="blue";
    ctx.fillRect(continueButton.x,continueButton.y,continueButton.width,continueButton.height);
    ctx.fillStyle="white"; ctx.fillText("CONTINUE",200,continueButton.y+30);
  }
}

function drawGameOverPopup(){
  ctx.fillStyle="rgba(0,0,0,0.3)"; ctx.fillRect(0,0,LOGICAL_WIDTH,LOGICAL_HEIGHT);
  ctx.fillStyle="white"; ctx.fillRect(25,220,350,180); ctx.strokeRect(25,220,350,180);
  ctx.fillStyle="black"; ctx.textAlign="center"; ctx.font="20px Arial";
  ctx.fillText("Bilal ko bhej tere bass ka kaam nahi",200,260);
  ctx.font="16px Arial"; ctx.fillText("Maaz ki gand dobara maroge?",200,290);
  yesButton.x=200-50; yesButton.y=310; ctx.fillStyle="green";
  ctx.fillRect(yesButton.x,yesButton.y,yesButton.width,yesButton.height);
  ctx.fillStyle="white"; ctx.fillText("YES",200,yesButton.y+28);
}

// ---------------- DRAW LOOP ----------------
function draw(){
  ctx.fillStyle="#4ec0ca"; ctx.fillRect(0,0,LOGICAL_WIDTH,LOGICAL_HEIGHT);

  if(images.cloud) ctx.drawImage(images.cloud,cloud.x,cloud.y,cloud.width,cloud.height);
  if(gameStarted && !gameOver){ cloud.x+=cloud.speed; if(cloud.x>LOGICAL_WIDTH) cloud.x=-cloud.width; }

  if(!gameStarted){ drawStartPopup(); requestAnimationFrame(draw); return; }

  if(!gameOver){ bird.velocity+=bird.gravity; if(bird.velocity>12) bird.velocity=12; bird.y+=bird.velocity; }
  if(images.bird) ctx.drawImage(images.bird,bird.x,bird.y,bird.width,bird.height); else { ctx.fillStyle="yellow"; ctx.fillRect(bird.x,bird.y,bird.width,bird.height); }

  for(let i=pipes.length-1;i>=0;i--){
    const pipe=pipes[i]; if(!gameOver) pipe.x-=3;
    if(images.bananaTop && images.bananaBottom){ ctx.drawImage(images.bananaBottom,pipe.x,pipe.bottom,pipe.width,LOGICAL_HEIGHT-pipe.bottom); ctx.drawImage(images.bananaTop,pipe.x,0,pipe.width,pipe.top); } 
    else{ ctx.fillStyle="green"; ctx.fillRect(pipe.x,0,pipe.width,pipe.top); ctx.fillRect(pipe.x,pipe.bottom,pipe.width,LOGICAL_HEIGHT-pipe.bottom); }
    const bx=bird.x+bird.width/2, by=bird.y+bird.height/2;
    if(bx>pipe.x && bx<pipe.x+pipe.width && (by<pipe.top || by>pipe.bottom)){
      if(!gameOver){ gameOver=true; bird.velocity=0; createCrashParticles(bx,by); stopPipes(); if(sounds.crash){try{sounds.crash.currentTime=0;sounds.crash.play();}catch(e){}} }
    }
    if(pipe.x+pipe.width<bird.x && !pipe.passed){ score++; pipe.passed=true; }
    if(pipe.x+pipe.width<0) pipes.splice(i,1);
  }

  if(bird.y+bird.height>560){ if(!gameOver){ gameOver=true; bird.y=560-bird.height; bird.velocity=0; createCrashParticles(bird.x+bird.width/2,bird.y+bird.height/2); stopPipes(); if(sounds.crash){try{sounds.crash.currentTime=0;sounds.crash.play();}catch(e){}} } }

  ctx.fillStyle="white"; ctx.font="28px Arial"; ctx.textAlign="left"; ctx.textBaseline="top"; ctx.fillText("Score: "+score,15,12);
  drawCrashParticles();
  ctx.fillStyle="#3cb043"; ctx.fillRect(0,560,LOGICAL_WIDTH,40);
  if(gameOver) drawGameOverPopup();

  requestAnimationFrame(draw);
}

// ---------------- START GAME ----------------
async function start(){
  await loadAllAssets();
  initState();
  requestAnimationFrame(draw);
}

start();

</script>
</body>
</html>
